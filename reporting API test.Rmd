---
title: "R Notebook"
output: html_notebook
---


```{r}
source("reportingAPI.R")
```

Constantes
```{r}
source("clavesCSOD_stg.R")
```


Recuperar un par de vistas y grabarlas a csv
```{r}
# Calculate the number of cores
no_cores <- detectCores() - 1
# Initiate cluster
cl <- makeCluster(no_cores)
registerDoParallel(cl)

sesion <- obtenerTokenSesion(apiSecret, apiKey)
listaVistas <- fromJSON(leermetadatos(sesion$sessionToken,sesion$sessionSecretKey))
vistas <- listaVistas$value$url

foreach(v = 1:length(vistas), .packages=c("digest","base64enc","httr","jsonlite","data.table","xml2")) %dopar% {
                if (!file.exists(paste(vistas[v], ".csv", sep = ""))) {
                    d<-leerOdata(vistas[v], sesion$sessionToken, sesion$sessionSecretKey)
                    fwrite(d, file = paste(vistas[v], ".csv", sep = ""))
                }
}

stopImplicitCluster()
```


